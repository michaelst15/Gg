script 2.2.15 :

#!/bin/bash

# =================== KONFIGURASI ===================
output_file="remediation_result.txt"
timestamp=$(date '+%F_%T' | tr ' :' '__')
backup_file="backup_2.2.15_telnet_server_$timestamp.txt"

# =================== METADATA ===================
judul="2.2.15 Ensure telnet-server is not installed (Automated)"
applicability="Level 1 - Server\nLevel 1 - Workstation"
description="The telnet-server package contains the telnet daemon, which accepts connections from users from other systems via the telnet protocol."
rationale="The telnet protocol is insecure and unencrypted. The use of an unencrypted transmission medium could allow a user with access to sniff network traffic the ability to steal credentials. The ssh package provides an encrypted session and stronger security."
remediation="Run the following command to remove the telnet-server package:\n# yum remove telnet-server"

# =================== BACKUP ===================
echo "📦 Membuat daftar paket telnet-server jika terpasang..."
rpm -qa | grep telnet-server > "$backup_file" 2>/dev/null
echo "✅ Backup daftar paket disimpan: $backup_file"

# =================== AUDIT & REMEDIASI ===================
hasil_audit=""
tindakan=""
status_akhir=""
file_service_diubah=""

if rpm -q telnet-server &>/dev/null; then
    hasil_audit="⚠️ Paket telnet-server ditemukan di sistem."
    tindakan="Menghapus paket telnet-server..."
    yum -y remove telnet-server &>/dev/null
    if rpm -q telnet-server &>/dev/null; then
        status_akhir="⚠️ Remediasi gagal, telnet-server masih terpasang."
    else
        status_akhir="Sudah Diperbaiki"
        file_service_diubah="telnet-server (paket dihapus)"
    fi
else
    hasil_audit="✅ Paket telnet-server tidak ditemukan di sistem."
    tindakan="Tidak ada tindakan diperlukan."
    status_akhir="Sudah Sesuai"
fi

# =================== SIMPAN HASIL AUDIT ===================
{
echo "================================================================================"
echo "🛡️ $judul"
echo "🕒 Waktu Eksekusi: $(date)"
echo ""
echo "📌 Profile Applicability:"
echo -e "$applicability"
echo ""
echo "📄 Description:"
echo "$description"
echo ""
echo "💡 Rationale:"
echo "$rationale"
echo ""
echo "🔧 Remediation:"
echo -e "$remediation"
echo ""
echo "📁 Backup informasi paket disimpan di:"
echo "- $backup_file"
echo ""
echo "📂 File/Service yang Diubah:"
if [ -n "$file_service_diubah" ]; then
    echo "- $file_service_diubah"
else
    echo "- Tidak ada"
fi
echo ""
echo "📌 Hasil Audit:"
echo "$hasil_audit"
echo ""
echo "🔧 Tindakan Remediasi:"
echo "$tindakan"
echo ""
echo "🧾 Hasil Status Akhir:"
echo "$status_akhir"
echo ""
echo "✅ Audit dan remediasi selesai."
echo "================================================================================"
echo ""
} >> "$output_file"

# =================== OUTPUT KE LAYAR ===================
echo "$hasil_audit"
echo "🧾 Hasil Status Akhir: $status_akhir"
echo "📄 Hasil audit ditulis ke: $output_file"
